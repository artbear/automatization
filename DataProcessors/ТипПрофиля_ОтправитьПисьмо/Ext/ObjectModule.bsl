
Процедура ВыполнитьСценарий() Экспорт
	
	ПочтовыйПрофиль = ПочтовыйПрофиль();
	Сообещение = ПочтовоеСообщение();
	
	ОтправитьСообщение(ПочтовыйПрофиль, Сообещение);
	
КонецПроцедуры

Функция ПочтовыйПрофиль()
	
	Профиль = Новый ИнтернетПочтовыйПрофиль;
	
	ЗаполнитьЗначенияСвойств(Профиль, ЭтотОбъект); // АдресСервераSMTP,ПользовательSMTP,ПарольSMTP,ПортSMTP,ИспользоватьSSLSMTP,ТолькоЗащищеннаяАутентификацияSMTP
	//Профиль.АутентификацияSMTP = СпособSMTPАутентификации.ПоУмолчанию;
	//Профиль.ТолькоЗащищеннаяАутентификацияSMTP = Истина;
	//Профиль.Пользователь = ПользовательSMTP;
	//Профиль.Пароль = ПарольSMTP;
	
	//Профиль.АдресСервераSMTP = "smtp.yandex.ru";
	//Профиль.ПользовательSMTP = "robot-1c-korus@yandex.ru";
	//Профиль.ПарольSMTP = "surok2015";
	//Профиль.ПортSMTP = 465;
	//
	//Профиль.ИспользоватьSSLSMTP = ИСТИНА; 
	//Профиль.ТолькоЗащищеннаяАутентификацияSMTP = ЛОЖЬ;
	
	Профиль.ВремяОжидания = 10;
	
	Возврат Профиль;
	
КонецФункции

Функция ПочтовоеСообщение()
	
	Сообщение = Новый ИнтернетПочтовоеСообщение;
	
	ЗаполнитьЗначенияСвойств(Сообщение, ЭтотОбъект); // Отправитель,ИмяОтправителя,Тема
	
	Получатели = ПолучателиСтрокой;
	Получатели = СтрЗаменить(Получатели, ";", Символы.ПС);
	Получатели = СтрЗаменить(Получатели, ",", Символы.ПС);
	Для сч = 1 по СтрЧислоСтрок(Получатели) Цикл
		Получатель = СтрПолучитьСтроку(Получатели, сч);
		Если Найти(Получатель, "@") = 0 Тогда
			Продолжить;
		КонецЕсли;
		
		Сообщение.Получатели.Добавить(Получатель);
	КонецЦикла;
	
	Текст = Сообщение.Тексты.Добавить(ТекстСтрокой);
	Текст.ТипТекста = ТипТекстаПочтовогоСообщения.ПростойТекст;
	
	Если ТипЗнч(ВложенияСоответствие) = Тип("Соответствие") Тогда
		Вложения = ВложенияСоответствие;
	Иначе
		Вложения = Новый Соответствие;
	КонецЕсли;
	
	Для каждого КлючИЗначение из Вложения Цикл
		Вложение = КлючИЗначение.Значение;
		ИмяВложения = КлючИЗначение.Ключ;
		Сообщение.Вложения.Добавить(Вложение, ИмяВложения);
	КонецЦикла;
	
	Возврат Сообщение;
	
КонецФункции

Процедура ОтправитьСообщение(Профиль, Сообщение)
	
	Почта = Новый ИнтернетПочта();
	Почта.Подключиться(Профиль);
	Почта.Послать(Сообщение);
	Почта.Отключиться();
	
КонецПроцедуры